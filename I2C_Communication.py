##############################
# SSD1306 # RasPi # GPIO
##############################
#    SDA  #   3   # GP4
#    SCL  #   5   # GP5
##############################


disp_land = [\
'  Hello! RasPi  ','    OLED Lib    ',\
'  for CPython   ','                ',\
'https://git.boku','nimo.com/oled/  ',\
'                ','by Wataru KUNINO',\
]

ssd1306 = 0x3C                           # OLED SSD1306のI2Cアドレス
d_mode_i = 0x00
d_mode_w = 0x40
d_init = b'\xAE\xD5\x80\x8D\x14\x20\x00\xDA\x12\x81\x00\xD9\xF1\xDB\x40\xA4\xA6\xAF'
d_home = b'\x21\x00\x7F\x22\x00\x07'

import smbus
from time import sleep

def main():
    d_font = load_font()
    print("loaded font len =",len(d_font))

    i2c = smbus.SMBus(1)
    i2c.write_i2c_block_data(ssd1306, d_mode_i, list(d_init)) 
    i2c.write_i2c_block_data(ssd1306, d_mode_i, list(d_home))
    for y in range(8)[::-1]:
        for x in range(16)[::-1]:
            i = ord(disp_land[y][x]) - 32
            if i > 0 and i*8+8 <= len(d_font):
                font = b''
                for j in range(8):
                    c = 0x00
                    for k in range(8):
                        c += ((d_font[i*8+7-k] >> j) & 0x01) << k
                    font += c.to_bytes(1,'little')
                i2c.write_i2c_block_data(ssd1306, d_mode_w, list(font))
            else:
                i2c.write_i2c_block_data(ssd1306, d_mode_w, list(d_font[0:8]))
    sleep(3)
            
def load_font():
    return b'\
\x00\x00\x00\x00\x00\x00\x00\x00\x10\x10\x10\x10\x10\x00\x10\x00\
\xD8\x48\x90\x00\x00\x00\x00\x00\x14\x7E\x28\x28\x28\xFC\x50\x00\
\x08\x3E\x48\x3C\x12\x7C\x10\x00\x42\xA4\x48\x10\x24\x4A\x84\x00\
\x30\x48\x50\x24\x54\x88\x76\x00\x40\x40\x80\x00\x00\x00\x00\x00\
\x02\x04\x08\x08\x08\x04\x02\x00\x80\x40\x20\x20\x20\x40\x80\x00\
\x00\x00\x00\x00\x00\x00\x00\x00\x10\x10\x10\xFE\x10\x10\x10\x00\
\x00\x00\x00\x00\xC0\x40\x80\x00\x00\x00\x00\xFE\x00\x00\x00\x00\
\x00\x00\x00\x00\x00\xC0\xC0\x00\x02\x04\x08\x10\x20\x40\x80\x00\
\x3C\x42\x42\x42\x42\x42\x3C\x00\x10\x30\x10\x10\x10\x10\x38\x00\
\x3C\x42\x02\x0C\x30\x40\x7E\x00\x3C\x42\x02\x1C\x02\x42\x3C\x00\
\x04\x0C\x14\x24\x44\x7E\x04\x00\x7E\x40\x7C\x42\x02\x42\x3C\x00\
\x3C\x42\x40\x7C\x42\x42\x3C\x00\x7E\x02\x04\x08\x08\x10\x10\x00\
\x3C\x42\x42\x3C\x42\x42\x3C\x00\x3C\x42\x42\x3E\x02\x42\x3C\x00\
\x00\x30\x30\x00\x30\x30\x00\x00\x00\x30\x30\x00\x30\x10\x20\x00\
\x00\x06\x38\xC0\x38\x06\x00\x00\x00\x00\xFE\x00\xFE\x00\x00\x00\
\x00\xC0\x38\x06\x38\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
\x38\x44\x9A\xAA\xB4\x40\x38\x00\x10\x28\x28\x44\x7C\x82\x82\x00\
\x7C\x42\x42\x7C\x42\x42\x7C\x00\x1C\x22\x40\x40\x40\x22\x1C\x00\
\x78\x44\x42\x42\x42\x44\x78\x00\x7E\x40\x40\x7C\x40\x40\x7E\x00\
\x7E\x40\x40\x7C\x40\x40\x40\x00\x1C\x22\x40\x4E\x42\x22\x1C\x00\
\x42\x42\x42\x7E\x42\x42\x42\x00\x38\x10\x10\x10\x10\x10\x38\x00\
\x02\x02\x02\x02\x02\x42\x3C\x00\x42\x44\x48\x50\x68\x44\x42\x00\
\x40\x40\x40\x40\x40\x40\x7E\x00\x82\xC6\xAA\xAA\x92\x92\x82\x00\
\x42\x62\x52\x4A\x46\x42\x42\x00\x18\x24\x42\x42\x42\x24\x18\x00\
\x7C\x42\x42\x7C\x40\x40\x40\x00\x18\x24\x42\x42\x4A\x24\x1A\x00\
\x7C\x42\x42\x7C\x48\x44\x42\x00\x3C\x42\x40\x3C\x02\x42\x3C\x00\
\xFE\x10\x10\x10\x10\x10\x10\x00\x42\x42\x42\x42\x42\x42\x3C\x00\
\x82\x82\x44\x44\x28\x28\x10\x00\x82\x92\x92\xAA\xAA\x44\x44\x00\
\x82\x44\x28\x10\x28\x44\x82\x00\x82\x44\x28\x10\x10\x10\x10\x00\
\x7E\x02\x04\x08\x10\x20\x7E\x00\x0E\x08\x08\x08\x08\x08\x0E\x00\
\x44\x44\x28\x7C\x10\x7C\x10\x00\xE0\x20\x20\x20\x20\x20\xE0\x00\
\x10\x28\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFE\x00\
\x02\x04\x06\x00\x00\x00\x00\x00\x00\x00\x38\x04\x3C\x44\x3C\x00\
\x40\x40\x58\x64\x44\x44\x78\x00\x00\x00\x38\x44\x40\x44\x38\x00\
\x04\x04\x34\x4C\x44\x44\x3C\x00\x00\x00\x38\x44\x7C\x40\x38\x00\
\x0C\x10\x38\x10\x10\x10\x10\x00\x00\x00\x3C\x44\x3C\x04\x38\x00\
\x40\x40\x58\x64\x44\x44\x44\x00\x10\x00\x10\x10\x10\x10\x10\x00\
\x08\x00\x08\x08\x08\x48\x30\x00\x20\x20\x24\x28\x30\x28\x24\x00\
\x30\x10\x10\x10\x10\x10\x10\x00\x00\x00\x68\x54\x54\x54\x54\x00\
\x00\x00\x58\x64\x44\x44\x44\x00\x00\x00\x38\x44\x44\x44\x38\x00\
\x00\x00\x78\x44\x78\x40\x40\x00\x00\x00\x3C\x44\x3C\x04\x04\x00\
\x00\x00\x58\x64\x40\x40\x40\x00\x00\x00\x3C\x40\x38\x04\x78\x00\
\x00\x20\x78\x20\x20\x24\x18\x00\x00\x00\x44\x44\x44\x4C\x34\x00\
\x00\x00\x44\x44\x28\x28\x10\x00\x00\x00\x44\x54\x54\x28\x28\x00\
\x00\x00\x44\x28\x10\x28\x44\x00\x00\x00\x44\x28\x28\x10\x60\x00\
\x00\x00\x7C\x08\x10\x20\x7C\x00\x06\x08\x08\x10\x08\x08\x06\x00\
\x10\x10\x10\x10\x10\x10\x10\x00\xC0\x20\x20\x10\x20\x20\xC0\x00\
\xC0\x40\x80\x00\x00\x00\x00\x00'

while True:
    main()